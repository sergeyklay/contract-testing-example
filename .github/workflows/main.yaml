name: Test

on: [push]

jobs:
  hello_world_job:

    runs-on: ${{ matrix.os }}
    name: Rest action

    strategy:
      # When set to true, GitHub cancels
      # all in-progress jobs if any matrix job fails.
      fail-fast: false

      matrix:
        os:
          - ubuntu-latest
          - macos-latest
          - windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Check cache before install
        if: matrix.os != 'windows-latest'
        run: |
          if [ -d /opt/hostedtoolcache ]; then
            ls -l /opt/hostedtoolcache
          fi

      - name: Check cache before install
        if: matrix.os == 'windows-latest'
        run: |
          if (Test-Path -Path "C:\hostedtoolcache\windows") {
            Get-ChildItem "C:\hostedtoolcache\windows"
          }

      - name: Setup specmatic
        uses: airslate-oss/setup-specmatic@b67981952f1fe9688bbc3f5916c76bcd78afc968
        with:
          specmatic-version: stable

      - name: Check cache after install
        if: matrix.os != 'windows-latest'
        run: |
          if [ -d /opt/hostedtoolcache ]; then
            ls -l /opt/hostedtoolcache
          fi

      - name: Print wrapper contents
        if: matrix.os != 'windows-latest'
        run: |
          if [ -f /opt/hostedtoolcache/specmatic/0.59.0/x64/specmatic ]; then
            cat /opt/hostedtoolcache/specmatic/0.59.0/x64/specmatic
          fi

      - name: Check cache after install
        if: matrix.os == 'windows-latest'
        run: |
          if (Test-Path -Path "C:\hostedtoolcache\windows") {
            Get-ChildItem "C:\hostedtoolcache\windows"
          }

      - name: Print wrapper contents
        if: matrix.os == 'windows-latest'
        run: |
          if (Test-Path -Path "C:\hostedtoolcache\windows\specmatic\0.59.0\x64\specmatic.bat") {
            Get-Content "C:\hostedtoolcache\windows\specmatic\0.59.0\x64\specmatic.bat"
          }

      - name: Find Java
        if: matrix.os != 'windows-latest'
        run: type -a java

      - name: Find specmatic
        if: matrix.os != 'windows-latest'
        run: type -a specmatic

      - name: Check specmatic version
        run: specmatic --version

      - name: Check specmatic version using jar file
        if: matrix.os == 'windows-latest'
        run: |
          if (Test-Path -Path "C:\hostedtoolcache\windows\specmatic\0.59.0\x64\specmatic.jar") {
            java -jar "C:\hostedtoolcache\windows\specmatic\0.59.0\x64\specmatic.jar" --version
          }

      - name: Check specmatic version using bat file
        if: matrix.os == 'windows-latest'
        run: |
          if (Test-Path -Path "C:\hostedtoolcache\windows\specmatic\0.59.0\x64\specmatic.jar") {
            & .\specmatic-test.bat --version
          }

      - name: Check specmatic version using ps1 file
        if: matrix.os == 'windows-latest'
        run: |
          if (Test-Path -Path "C:\hostedtoolcache\windows\specmatic\0.59.0\x64\specmatic.jar") {
            .\specmatic-test.ps1
          }
